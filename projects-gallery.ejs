<div class="projects-listing">
<%
// Lowercase first letter of a string
const lcFirst = (str) => str ? str.charAt(0).toLowerCase() + str.slice(1) : '';

// Collect all unique categories
const allCategories = new Set();
for (const item of items) {
  if (item.categories) {
    for (const cat of item.categories) {
      allCategories.add(cat);
    }
  }
}
// Use custom order if provided, otherwise sort alphabetically
const orderedCategories = templateParams['category-order']
  ? templateParams['category-order'].filter(cat => allCategories.has(cat))
  : Array.from(allCategories).sort();
%>
<% for (const category of orderedCategories) { %>
<h2><%= category %></h2>
<% const desc = templateParams['category-descriptions'] && templateParams['category-descriptions'][category]; %>
<% if (desc) { %>
<p><%- desc %></p>
<% } %>
<% if (category === 'R Packages') { %>
<div class="package-list">
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<div class="package-item" <%= metadataAttrs(item) %>>
<a href="<%- item.path %>" class="package-image">
<img src="<%- item.image %>" alt="<%= item.title %>">
</a>
<div class="package-content">
<p><span class="package-title"><%= item.title %></span>, <%- lcFirst(item.description) %></p>
</div>
</div>
<% } %>
<% } %>
</div>
<% } else if (category === 'Books') { %>
<div class="books-list">
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<a href="<%- item.path %>" class="book-item" title="<%= item.title %>" <%= metadataAttrs(item) %>>
<img src="<%- item.image %>" alt="<%= item.title %>">
</a>
<% } %>
<% } %>
</div>
<% } else if (category === 'Data Sets') { %>
<div class="hex-grid">
<%
  const colsPerRow = 5;
  let hexIndex = 0;
%>
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<%
  const row = Math.floor(hexIndex / colsPerRow);
  const isOffsetRow = row % 2 === 1;
  const isFirstInRow = hexIndex % colsPerRow === 0;
  hexIndex++;
%>
<a href="<%- item.path %>" class="hex-item<%= isOffsetRow ? ' hex-offset' : '' %><%= isFirstInRow && isOffsetRow ? ' hex-first-offset' : '' %>" title="<%= item.title %>" <%= metadataAttrs(item) %>>
<img src="<%- item.image %>" alt="<%= item.title %>">
</a>
<% } %>
<% } %>
</div>
<% } else { %>
<ul>
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<li <%= metadataAttrs(item) %>>
<a href="<%- item.path %>"><%= item.title %></a>
</li>
<% } %>
<% } %>
</ul>
<% } %>
<% } %>
</div>
