<div class="projects-listing">
<%
// Lowercase first letter of a string
const lcFirst = (str) => str ? str.charAt(0).toLowerCase() + str.slice(1) : '';

// Collect all unique categories
const allCategories = new Set()
for (const item of items) {
  if (item.categories) {
    for (const cat of item.categories) {
      allCategories.add(cat);
    }
  }
}
// Use custom order if provided, otherwise sort alphabetically
const orderedCategories = templateParams['category-order']
  ? templateParams['category-order'].filter(cat => allCategories.has(cat))
  : Array.from(allCategories).sort();
%>
<% for (const category of orderedCategories) { %>
<h2><%= category %></h2>
<% const desc = templateParams['category-descriptions'] && templateParams['category-descriptions'][category]; %>
<% if (desc) { %>
<p><%- desc %></p>
<% } %>
<% if (category === 'R Packages') { %>
<div class="package-list">
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<div class="package-item" <%= metadataAttrs(item) %>>
<a href="<%- item.path %>" class="package-image">
<img src="<%- item.image %>" alt="<%= item.title %>">
</a>
<div class="package-content">
<p><span class="package-title"><%= item.title %></span>, <%- lcFirst(item.description) %></p>
</div>
</div>
<% } %>
<% } %>
</div>
<% } else if (category === 'Books') { %>
<div class="books-list">
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<a href="<%- item.path %>" class="book-item" title="<%= item.title %>" <%= metadataAttrs(item) %>>
<img src="<%- item.image %>" alt="<%= item.title %>">
</a>
<% } %>
<% } %>
</div>
<% } else if (category === 'Websites') { %>
<div class="websites-grid">
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<a href="<%- item.path %>" class="website-card" <%= metadataAttrs(item) %>>
<div class="website-image">
<img src="<%- item.image %>" alt="<%= item.title %>">
</div>
<div class="website-content">
<h3><%= item.title %></h3>
<p><%= item.description %></p>
</div>
</a>
<% } %>
<% } %>
</div>
<% } else if (category === 'Data Sets') { %>
<div class="hex-grid-container">
<div class="hex-grid">
<%
  let hexIndex = 0;
%>
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<%
  // Calculate offset for different column counts
  // Honeycomb pattern: odd rows have N items, even (offset) rows have N-1 items
  // 5 cols: 5+4=9 cycle, offset at position 5
  // 4 cols: 4+3=7 cycle, offset at position 4
  // 3 cols: 3+2=5 cycle, offset at position 3
  const isOffset5 = hexIndex % 9 === 5;
  const isOffset4 = hexIndex % 7 === 4;
  const isOffset3 = hexIndex % 5 === 3;
  hexIndex++;
%>
<a href="<%- item.path %>" class="hex-item<%= isOffset5 ? ' hex-offset-5' : '' %><%= isOffset4 ? ' hex-offset-4' : '' %><%= isOffset3 ? ' hex-offset-3' : '' %>" data-description="<%= item.title %> - <%= item.description.trim() %>" <%= metadataAttrs(item) %>>
<img src="<%- item.image %>" alt="<%= item.title %>">
</a>
<% } %>
<% } %>
</div>
<div class="hex-description">
<span class="hex-description-default">Hover over a hex for more information</span>
<span class="hex-description-text"></span>
</div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const hexItems = document.querySelectorAll('.hex-grid .hex-item');
  const descDefault = document.querySelector('.hex-description-default');
  const descText = document.querySelector('.hex-description-text');

  hexItems.forEach(item => {
    item.addEventListener('mouseenter', function() {
      descDefault.style.display = 'none';
      descText.style.display = 'inline';
      descText.textContent = this.dataset.description;
    });
    item.addEventListener('mouseleave', function() {
      descDefault.style.display = 'inline';
      descText.style.display = 'none';
      descText.textContent = '';
    });
  });
});
</script>
<% } else { %>
<ul>
<% for (const item of items) { %>
<% if (item.categories && item.categories.includes(category)) { %>
<li <%= metadataAttrs(item) %>>
<a href="<%- item.path %>"><%= item.title %></a>
</li>
<% } %>
<% } %>
</ul>
<% } %>
<% } %>
</div>
