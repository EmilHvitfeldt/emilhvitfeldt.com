---
title: Analysing ethnic diversity in Californian school
date: '2018-05-01'
categories: [ggplot2]
image:
  preview_only: true
---



<div class="note">
<p>This code have been lightly revised to make sure it works as of 2018-12-16.</p>
</div>
<p>I will In this post explore the ethnic diversity of the student population in schools in California. We will utilize the data provided by <a href="https://www.cde.ca.gov/">California Department of Education</a> that has <a href="https://www.cde.ca.gov/ds/sd/sd/filesenr.asp">Enrollment by School</a> which includes “school-level enrollment by racial/ethnic designation, gender, and grade”.</p>
<p>We will combine this data with two other datasets that contain:</p>
<ul>
<li>Longitude and latitude of the schools</li>
<li>Income information of the cities the schools are located in</li>
</ul>
<p>Hopefully we will be able to draw some cool inference using these datasets while working though the complications you get when you combine datasets from the wild.</p>
<div id="loading-packages" class="section level2">
<h2>Loading packages</h2>
<p>This will be a fairly standard data science exercise so we will stick to the <code>tidyverse</code>, <code>rvest</code> for scraping, <code>patchwork</code> for plot stitching and add a little fancyness with <code>ggmap</code> for local maps.</p>
<pre class="r"><code>library(tidyverse)
library(rvest)
library(patchwork)
library(ggmap)</code></pre>
</div>
<div id="enrollment-data" class="section level2">
<h2>Enrollment data</h2>
<p>We start by downloading the dataset to our local disk and read it from there this is mainly to be nice, and for the fact the the download speed on the files we work with are a little slow. This can be done using <code>readr</code>’s <code>read_tsv()</code>.</p>
<pre class="r"><code>data &lt;- readr::read_tsv(&quot;filesenr.asp.txt&quot;)</code></pre>
<p>To get an idea of the data lets have a quick <code>glimpse()</code></p>
<pre class="r"><code>glimpse(data)
## Rows: 129,813
## Columns: 23
## $ CDS_CODE  &lt;chr&gt; &quot;33672490000001&quot;, &quot;33672490000001&quot;, &quot;33672490000001&quot;, &quot;3367…
## $ COUNTY    &lt;chr&gt; &quot;Riverside&quot;, &quot;Riverside&quot;, &quot;Riverside&quot;, &quot;Riverside&quot;, &quot;Rivers…
## $ DISTRICT  &lt;chr&gt; &quot;San Jacinto Unified&quot;, &quot;San Jacinto Unified&quot;, &quot;San Jacinto …
## $ SCHOOL    &lt;chr&gt; &quot;Nonpublic, Nonsectarian Schools&quot;, &quot;Nonpublic, Nonsectarian…
## $ ETHNIC    &lt;dbl&gt; 9, 5, 1, 9, 7, 6, 6, 7, 5, 5, 9, 9, 7, 6, 4, 3, 6, 1, 4, 5,…
## $ GENDER    &lt;chr&gt; &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, &quot;F&quot;, &quot;M&quot;, &quot;F&quot;, &quot;M&quot;, &quot;F&quot;, &quot;F&quot;, &quot;M&quot;, &quot;F&quot;,…
## $ KDGN      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 3, 0, 17, 1, 1, 1, 1, 0, 1, 4…
## $ GR_1      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 3, 2, 18, 2, 1, 0, 0, 0, 1, 4…
## $ GR_2      &lt;dbl&gt; 0, 1, 0, 0, 0, 1, 0, 0, 0, 3, 2, 5, 28, 1, 3, 0, 0, 0, 1, 3…
## $ GR_3      &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 2, 0, 4, 5, 3, 24, 1, 3, 0, 0, 0, 3, 6…
## $ GR_4      &lt;dbl&gt; 0, 2, 0, 1, 1, 0, 0, 0, 0, 6, 5, 1, 26, 0, 0, 0, 0, 0, 1, 4…
## $ GR_5      &lt;dbl&gt; 0, 1, 0, 0, 0, 3, 0, 1, 0, 6, 7, 7, 30, 2, 2, 0, 1, 1, 1, 6…
## $ GR_6      &lt;dbl&gt; 0, 4, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_7      &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_8      &lt;dbl&gt; 1, 2, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ UNGR_ELM  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_9      &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_10     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_11     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_12     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ UNGR_SEC  &lt;dbl&gt; 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ ENR_TOTAL &lt;dbl&gt; 2, 16, 1, 1, 1, 6, 2, 7, 2, 29, 25, 18, 143, 7, 10, 1, 2, 1…
## $ ADULT     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</code></pre>
<p>and we notice that <code>CDS_CODE</code> is being read as a chr which is favorable in this case since we don’t actually want it as a integer but rather as an ID variable. If this column had been converted to integers we would have lost leading zeros which could lead to trouble.</p>
</div>
<div id="longitude-and-latitude-data" class="section level2">
<h2>Longitude and latitude data</h2>
<p>The longitude and latitude of the schools are also available on California Department of Education’s website <a href="https://www.cde.ca.gov/ds/si/ds/fspubschls.asp">here</a>. It includes quite a lot of information, a lot of it uninteresting for this project so will take a subset of it for further analysis. <code>read_tsv</code> complaints a little bit when reading it in, but after some crosschecking with the .xls file also provided, does it seem to be correct so we will ignore the error (don’t just ignore error all the time! most of the time they are telling you something important! in this case the problems stems from missing values and tab separated values don’t mix that nicely).</p>
<pre class="r"><code>longlat_raw &lt;- read_tsv(&quot;pubschls.txt&quot;)
longlat &lt;- longlat_raw %&gt;%
  select(CDSCode, Latitude, Longitude, School, City)</code></pre>
<p>Lets have a peak at the data:</p>
<pre class="r"><code>glimpse(longlat)
## Rows: 10,014
## Columns: 5
## $ CDSCode   &lt;chr&gt; &quot;01100170000000&quot;, &quot;01100170109835&quot;, &quot;01100170112607&quot;, &quot;0110…
## $ Latitude  &lt;dbl&gt; 37.65821, 37.52144, 37.80452, 37.86899, 37.78465, 37.84737,…
## $ Longitude &lt;dbl&gt; -122.0971, -121.9939, -122.2682, -122.2784, -122.2386, -122…
## $ School    &lt;chr&gt; NA, &quot;FAME Public Charter&quot;, &quot;Envision Academy for Arts &amp; Tec…
## $ City      &lt;chr&gt; &quot;Hayward&quot;, &quot;Newark&quot;, &quot;Oakland&quot;, &quot;Berkeley&quot;, &quot;Oakland&quot;, &quot;Oak…</code></pre>
<p>we see that the the columns have been read in in appropriate ways. We recognize the <code>CDS_CODE</code> from before as <code>CDSCode</code> in this dataset which we will use to combine the datasets later.</p>
</div>
<div id="income-data" class="section level2">
<h2>Income data</h2>
<p>Lastly we will get some income data, I found some fairly good data on <a href="https://en.wikipedia.org/wiki/List_of_California_locations_by_income">Wikipedia</a>. We use simple <code>rvest</code> tools to extract the table from the website and give it column names.</p>
<p>While the income data is quite lovely, would it be outside the scope of this post to identify which census-designated place (CDP) each of the schools belong it. The second best option is to use the income data on a county by county basis. This will ofcause mean that we trade a bit of granularity for time. But hopefully it will still lead to some meaningful findings.</p>
<pre class="r"><code>url &lt;- &quot;https://en.wikipedia.org/wiki/List_of_California_locations_by_income&quot;
income_data &lt;- read_html(url) %&gt;%
  html_nodes(&quot;table&quot;) %&gt;%
  .[2] %&gt;%
  html_table() %&gt;%
  .[[1]] %&gt;%
  set_names(c(&quot;county&quot;, &quot;population&quot;, &quot;population_density&quot;, 
              &quot;per_capita_income&quot;, &quot;median_household_income&quot;,
              &quot;median_family_income&quot;))</code></pre>
<p>lets take a look at the table:</p>
<pre class="r"><code>glimpse(income_data)
## Rows: 58
## Columns: 6
## $ county                  &lt;chr&gt; &quot;Alameda&quot;, &quot;Alpine&quot;, &quot;Amador&quot;, &quot;Butte&quot;, &quot;Cala…
## $ population              &lt;chr&gt; &quot;1,559,308&quot;, &quot;1,202&quot;, &quot;37,159&quot;, &quot;221,578&quot;, &quot;4…
## $ population_density      &lt;chr&gt; &quot;2,109.8&quot;, &quot;1.6&quot;, &quot;62.5&quot;, &quot;135.4&quot;, &quot;44.0&quot;, &quot;1…
## $ per_capita_income       &lt;chr&gt; &quot;$36,439&quot;, &quot;$24,375&quot;, &quot;$27,373&quot;, &quot;$24,430&quot;, &quot;…
## $ median_household_income &lt;chr&gt; &quot;$73,775&quot;, &quot;$61,343&quot;, &quot;$52,964&quot;, &quot;$43,165&quot;, &quot;…
## $ median_family_income    &lt;chr&gt; &quot;$90,822&quot;, &quot;$71,932&quot;, &quot;$68,765&quot;, &quot;$56,934&quot;, &quot;…</code></pre>
<p>here we see a couple of things that look weirds. Every column characters valued, which it shouldn’t be since 5 out of the 6 variables should be numerical.</p>
<p>We will use the wonderful <code>parse_number</code> function from the <code>readr</code> package to convert the character values to numeric.</p>
<pre class="r"><code>income_data_clean &lt;- income_data %&gt;%
  mutate_at(vars(population:median_family_income), parse_number)</code></pre>
<p>a quick glimpse to see everything went well</p>
<pre class="r"><code>glimpse(income_data_clean)
## Rows: 58
## Columns: 6
## $ county                  &lt;chr&gt; &quot;Alameda&quot;, &quot;Alpine&quot;, &quot;Amador&quot;, &quot;Butte&quot;, &quot;Cala…
## $ population              &lt;dbl&gt; 1559308, 1202, 37159, 221578, 44921, 21424, 1…
## $ population_density      &lt;dbl&gt; 2109.8, 1.6, 62.5, 135.4, 44.0, 18.6, 1496.0,…
## $ per_capita_income       &lt;dbl&gt; 36439, 24375, 27373, 24430, 29296, 22211, 387…
## $ median_household_income &lt;dbl&gt; 73775, 61343, 52964, 43165, 54936, 50503, 797…
## $ median_family_income    &lt;dbl&gt; 90822, 71932, 68765, 56934, 67100, 56472, 950…</code></pre>
<p>And we are good to go!</p>
</div>
<div id="ethnic-diversity" class="section level2">
<h2>Ethnic diversity</h2>
<p>To be able to compare the ethnic diversity between schools we need a measure that describes diversity to begin with. I’ll use the diversity index <a href="https://www.unc.edu/~pmeyer/carstat/tools.html">developed in 1991</a> by a researcher at the University of North Carolina at Chapel Hill. The index simply asks: “What is the probability that two people in a population picked at random will be from different ethnicity”. At first this can be seen as a daunting task, but if we look at it geometrically we notice that the calculations are quite straight forward.</p>
<p>If we imagine a population of 10 people split into two ethnicities, with 5 in each. Then we can draw the following outcome space:</p>
<pre class="r"><code>diversity_plot(makeup = rep(5, 2))</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-13-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>(the code for <code>diversity_plot</code> is displayed in the end of the article for those interested.)</p>
<p>Where the colored squares represent random picks with the same ethnicity, light grey squares picks with different ethnicities. Dark grey indicate impossible picks (same person picked twice) and should be ignored. Now the diversity index can be calculated by dividing the number of light grey squares with the sum of light grey and colored squares.</p>
<p>Before we go on, lets look at how different populations have different diversity indexes. If we only have two groups, will the diversity score converge to 0.5 for large populations, however with small populations will the index be quite large since each person contribute such a big percentage of the group, making it harder to pick another one in the same group.</p>
<pre class="r"><code>diversity_plot(rep(1, 2)) + 
  diversity_plot(rep(2, 2)) +
  diversity_plot(rep(4, 2)) +
  diversity_plot(rep(8, 2))</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-14-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>Effectively giving that adding a single person from a new group will maximize the contribution to the index.</p>
<pre class="r"><code>diversity_plot(c(rep(1, 2), 1, 1, 1)) + 
  diversity_plot(c(rep(2, 2), 1, 1, 1)) +
  diversity_plot(c(rep(4, 2), 1, 1, 1)) +
  diversity_plot(c(rep(8, 2), 1, 1, 1))</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-15-1.png" width="700px" style="display: block; margin: auto;" /></p>
<pre class="r"><code>diversity_plot(c(2, 3, 4, 5, 6) * 1) + 
  diversity_plot(c(2, 3, 4, 5, 6) * 2) +
  diversity_plot(c(2, 3, 4, 5, 6) * 3) +
  diversity_plot(c(2, 3, 4, 5, 6) * 4)</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-16-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>Now that we have seen the diversity index in use lets apply it to the data we have collected.</p>
<p>We would like to have the data in a different kind of tidy format, namely we want each row to represent each school. Taking another look at the data</p>
<pre class="r"><code>glimpse(data)
## Rows: 129,813
## Columns: 23
## $ CDS_CODE  &lt;chr&gt; &quot;33672490000001&quot;, &quot;33672490000001&quot;, &quot;33672490000001&quot;, &quot;3367…
## $ COUNTY    &lt;chr&gt; &quot;Riverside&quot;, &quot;Riverside&quot;, &quot;Riverside&quot;, &quot;Riverside&quot;, &quot;Rivers…
## $ DISTRICT  &lt;chr&gt; &quot;San Jacinto Unified&quot;, &quot;San Jacinto Unified&quot;, &quot;San Jacinto …
## $ SCHOOL    &lt;chr&gt; &quot;Nonpublic, Nonsectarian Schools&quot;, &quot;Nonpublic, Nonsectarian…
## $ ETHNIC    &lt;dbl&gt; 9, 5, 1, 9, 7, 6, 6, 7, 5, 5, 9, 9, 7, 6, 4, 3, 6, 1, 4, 5,…
## $ GENDER    &lt;chr&gt; &quot;M&quot;, &quot;M&quot;, &quot;M&quot;, &quot;F&quot;, &quot;F&quot;, &quot;M&quot;, &quot;F&quot;, &quot;M&quot;, &quot;F&quot;, &quot;F&quot;, &quot;M&quot;, &quot;F&quot;,…
## $ KDGN      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 3, 0, 17, 1, 1, 1, 1, 0, 1, 4…
## $ GR_1      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 3, 2, 18, 2, 1, 0, 0, 0, 1, 4…
## $ GR_2      &lt;dbl&gt; 0, 1, 0, 0, 0, 1, 0, 0, 0, 3, 2, 5, 28, 1, 3, 0, 0, 0, 1, 3…
## $ GR_3      &lt;dbl&gt; 1, 0, 1, 0, 0, 0, 0, 2, 0, 4, 5, 3, 24, 1, 3, 0, 0, 0, 3, 6…
## $ GR_4      &lt;dbl&gt; 0, 2, 0, 1, 1, 0, 0, 0, 0, 6, 5, 1, 26, 0, 0, 0, 0, 0, 1, 4…
## $ GR_5      &lt;dbl&gt; 0, 1, 0, 0, 0, 3, 0, 1, 0, 6, 7, 7, 30, 2, 2, 0, 1, 1, 1, 6…
## $ GR_6      &lt;dbl&gt; 0, 4, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_7      &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_8      &lt;dbl&gt; 1, 2, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ UNGR_ELM  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_9      &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_10     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_11     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ GR_12     &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ UNGR_SEC  &lt;dbl&gt; 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ ENR_TOTAL &lt;dbl&gt; 2, 16, 1, 1, 1, 6, 2, 7, 2, 29, 25, 18, 143, 7, 10, 1, 2, 1…
## $ ADULT     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</code></pre>
<p>and we would like to across each <code>ETHNIC</code> category within each school, ignoring <code>GENDER</code> (including gender could be a interesting question for another time). Luckily the total enrollment is already calculated for us <code>ENR_TOTAL</code> so we don’t have to do that manually.</p>
<pre class="r"><code>small_data &lt;- data %&gt;%
  select(CDS_CODE, ETHNIC, ENR_TOTAL) %&gt;%
  group_by(CDS_CODE, ETHNIC) %&gt;%
  summarize(ENR_TOTAL = sum(ENR_TOTAL)) %&gt;%
  spread(ETHNIC, ENR_TOTAL, fill = 0) %&gt;%
  ungroup()</code></pre>
<pre class="r"><code>glimpse(small_data)
## Rows: 10,483
## Columns: 10
## $ CDS_CODE &lt;chr&gt; &quot;01100170112607&quot;, &quot;01100170123968&quot;, &quot;01100170124172&quot;, &quot;01100…
## $ `0`      &lt;dbl&gt; 0, 3, 0, 2, 0, 0, 1, 0, 0, 0, 0, 0, 0, 3, 23, 0, 4, 2, 7, 0,…
## $ `1`      &lt;dbl&gt; 5, 6, 0, 2, 0, 0, 1, 1, 1, 0, 1, 0, 0, 3, 6, 0, 0, 4, 1, 1, …
## $ `2`      &lt;dbl&gt; 8, 24, 161, 22, 0, 11, 0, 15, 0, 3, 30, 3, 98, 109, 49, 91, …
## $ `3`      &lt;dbl&gt; 5, 2, 1, 0, 0, 2, 0, 23, 0, 2, 2, 0, 4, 16, 0, 1, 1, 9, 0, 0…
## $ `4`      &lt;dbl&gt; 1, 2, 7, 5, 1, 1, 2, 2, 1, 0, 18, 0, 21, 35, 16, 34, 21, 104…
## $ `5`      &lt;dbl&gt; 212, 125, 18, 96, 21, 109, 123, 452, 425, 21, 190, 8, 17, 97…
## $ `6`      &lt;dbl&gt; 150, 23, 14, 75, 58, 95, 21, 84, 23, 1, 33, 6, 7, 81, 98, 63…
## $ `7`      &lt;dbl&gt; 18, 16, 35, 115, 2, 13, 1, 1, 8, 10, 85, 12, 30, 98, 177, 16…
## $ `9`      &lt;dbl&gt; 4, 7, 121, 57, 5, 11, 0, 10, 4, 2, 21, 2, 6, 41, 64, 62, 34,…</code></pre>
<p>Before we move on, lets reference the data documentation to see what each of the <code>ETHNIC</code> numbers mean. <a href="https://www.cde.ca.gov/ds/sd/sd/fsenr.asp">File Structure</a> which states the following:</p>
<ul>
<li>Code 0 = Not reported</li>
<li>Code 1 = American Indian or Alaska Native, Not Hispanic</li>
<li>Code 2 = Asian, Not Hispanic</li>
<li>Code 3 = Pacific Islander, Not Hispanic</li>
<li>Code 4 = Filipino, Not Hispanic</li>
<li>Code 5 = Hispanic or Latino</li>
<li>Code 6 = African American, not Hispanic</li>
<li>Code 7 = White, not Hispanic</li>
<li>Code 9 = Two or More Races, Not Hispanic</li>
</ul>
<p>So now we have two decisions we need to deal with before moving on. How to take care of the “Not reported” cases, and “Two or More Races, Not Hispanic”. The second point have been discussed before <a href="https://www.unc.edu/~pmeyer/carstat/tools.html">Updating the USA TODAY Diversity Index</a>.</p>
<p>Lets start with the case of code 0. We notice that the category generally is quite small compared to the other groups, so we need to reason about what would happen if we drop them.</p>
<pre class="r"><code>diversity_plot(c(10, 10, 2)) +
  diversity_plot(c(10, 10)) +
  diversity_plot(c(11, 11)) +
  diversity_plot(c(10, 10, 10, 3)) +
  diversity_plot(c(10, 10, 10)) +
  diversity_plot(c(11, 11, 11)) +
  plot_layout(nrow = 2)</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-20-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>as we see that having them be a separate group (first column), gives a higher diversity score then ignoring them (second column) or adding them evenly to the remaining groups (third column). However ignoring them and spreading them gives mostly the same diversity index (when the group is small compared the the whole). Thus we will drop the “Not reported” column as it would otherwise inflate the diversity index.</p>
<p>Coping with multi ethnicity is quite hard, and we will pick between four options.</p>
<ul>
<li>Assume everyone in “Two or More Races, Not Hispanic” is the same ethnicity</li>
<li>Assume everyone in “Two or More Races, Not Hispanic” is all different ethnicities</li>
<li>Ignore the group “Two or More Races, Not Hispanic”</li>
<li>Distribute the group “Two or More Races, Not Hispanic” evenly into the other groups</li>
</ul>
<p>Lets evaluate the different choices with some visualizations.</p>
<p>Assume we have 3 main groups. with 5 in each, and an additional 3 people who have picked “Two or More Races, Not Hispanic”.</p>
<pre class="r"><code>diversity_plot(c(5, 5, 5, 3)) +
  diversity_plot(c(5, 5, 5, rep(1, 3))) +
  diversity_plot(c(5, 5, 5)) +
  diversity_plot(c(6, 6, 6))</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-21-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>Option 3 and 4 both yields low diversity index considering that the choice of “Two or More Races, Not Hispanic” must indicate that they are different enough not to be put into one of the more precisely defined groups. The first option while appalling from a computational standpoint would treat a black-white mixture and an Asian-American Indian as members of the same group even though they had no racial identity in common. Thus We will work with the second option which in any case might overestimate the diversity of any given population as they oath to be some people “Two or More Races, Not Hispanic” with identical mixes (siblings would be a prime example).</p>
<p>After deciding we can create a <code>dplyr</code> friendly function to calculate the diversity index based on a collection of columns. Here we denote <code>y</code> as the column denoting “Two or More Races, Not Hispanic”.</p>
<pre class="r"><code>diversity &lt;- function(..., y) {
 x &lt;- sapply(list(...), cbind)
 total &lt;- cbind(x, y)
 1 - (rowSums(x ^ 2) - rowSums(x)) / (rowSums(total) ^ 2 - rowSums(total))
}</code></pre>
</div>
<div id="bring-back-the-data" class="section level2">
<h2>Bring back the data!</h2>
<p>We are finally able to calculate some diversity indexes!!! Using our recently made function within <code>mutate</code> gives us what we need.</p>
<pre class="r"><code>data_diversity &lt;- small_data %&gt;%
  mutate(diversity = diversity(`1`, `2`, `3`, `4`, `5`, `6`, `7`, y = `9`))</code></pre>
<p>Lets run a <code>summary</code> to see what ranges we get.</p>
<pre class="r"><code>summary(data_diversity$diversity)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##  0.0000  0.3113  0.5216  0.4686  0.6351  1.0000      88</code></pre>
<p>Interesting. All the number are between 0 and 1 which is good! that means that the <code>diversity</code> worked as intended. However there are 88 schools have <code>NA</code> valued diversity, lets look at those schools:</p>
<pre class="r"><code>filter(data_diversity, is.na(diversity)) %&gt;% head()
## # A tibble: 6 x 11
##   CDS_CODE         `0`   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `9` diversity
##   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 01612590121210     0     0     0     0     0     0     1     0     0       NaN
## 2 04755070000001     2     0     0     0     0     0     0     1     0       NaN
## 3 06615980000001     0     0     0     0     0     0     0     1     0       NaN
## 4 07618040000000     0     0     0     0     0     0     0     1     0       NaN
## 5 09619600000001     0     0     0     0     0     0     0     1     0       NaN
## 6 10622400114587     0     0     0     0     0     1     0     0     0       NaN</code></pre>
<p>So it seems like some of the schools have such a low number of kids that the calculations break down. We will exclude these schools for now.</p>
<pre class="r"><code>data_diversity &lt;- data_diversity %&gt;%
  filter(!is.na(diversity))</code></pre>
<p>Next lets look at the distribution of diversity indexes.</p>
<pre class="r"><code>ggplot(data_diversity, aes(diversity)) +
  geom_histogram(binwidth = 0.01)</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-27-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>We notice that most of the schools follow a nice shape, except a spike at 0 and 1. Lets look at the 0’s first:</p>
<pre class="r"><code>data_diversity %&gt;%
  filter(diversity == 0) %&gt;%
  head(20)
## # A tibble: 20 x 11
##    CDS_CODE        `0`   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `9` diversity
##    &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 016116800000…     0     0     0     0     0     0     2     0     0         0
##  2 021002502300…     0     2     0     0     0     0     0     0     0         0
##  3 076171300000…     0     0     0     0     0     0     0     6     0         0
##  4 096195200000…     0     0     0     0     0     0     0     3     0         0
##  5 096197800000…     0     0     0     0     0     0     0     4     0         0
##  6 106212510304…     0     0     0     0     0    26     0     0     0         0
##  7 106212510308…     0     0     0     0     0     2     0     0     0         0
##  8 106215801089…     1     0     0     0     0    13     0     0     0         0
##  9 106236401268…     0     0     0     0     0    47     0     0     0         0
## 10 107380910301…     0     0     0     0     0    12     0     0     0         0
## 11 107399900000…     0     0     0     0     0     3     0     0     0         0
## 12 107512710302…     0     0     0     0     0    18     0     0     0         0
## 13 107512710307…     0     0     0     0     0     5     0     0     0         0
## 14 107523410303…     0     0     0     0     0     8     0     0     0         0
## 15 107523460058…     0     0     0     0     0   174     0     0     0         0
## 16 117656211300…     2     0     0     0     0     9     0     0     0         0
## 17 126281000000…     0     0     0     0     0     0     0     2     0         0
## 18 127538212300…     0     0     0     0     0     0     0    11     0         0
## 19 127538261078…     0     0     0     0     0     0     0     7     0         0
## 20 131013213301…     0     0     0     0     0     8     0     0     0         0</code></pre>
<p>These all appear to be schools with just one race in them, most appear to be of category 5 which is “Hispanic or Latino”. Next lets take a look at the 1’s:</p>
<pre class="r"><code>data_diversity %&gt;%
  filter(diversity == 1) %&gt;%
  head(20)
## # A tibble: 20 x 11
##    CDS_CODE        `0`   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `9` diversity
##    &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 016112700000…     0     0     1     0     0     1     0     1     0         1
##  2 046152300000…     0     0     0     0     0     0     0     1     1         1
##  3 056155600000…     0     0     0     0     0     1     0     1     0         1
##  4 076176200000…     0     0     0     0     0     0     1     1     0         1
##  5 076177000000…     1     0     1     0     0     1     0     1     0         1
##  6 097378300000…     1     1     0     0     0     1     0     1     0         1
##  7 106215801202…     0     0     0     0     0     0     1     1     0         1
##  8 117548111301…     0     0     0     0     0     1     0     1     0         1
##  9 141014014300…     0     1     0     0     0     1     0     1     0         1
## 10 156336200000…     0     0     0     0     0     1     1     0     0         1
## 11 176402200000…     0     0     0     0     0     1     0     1     0         1
## 12 196456819961…     0     0     0     0     0     1     0     1     0         1
## 13 197343761144…     0     0     0     0     0     1     1     0     1         1
## 14 207641420300…     0     0     0     0     0     1     0     1     0         1
## 15 246578900000…     0     0     0     0     0     0     1     1     0         1
## 16 257358525301…     0     0     0     0     0     0     0     1     1         1
## 17 261026401286…     0     0     0     0     0     1     0     1     1         1
## 18 286624100000…     0     0     0     0     0     1     0     1     0         1
## 19 316684500000…     0     0     0     0     0     1     0     1     0         1
## 20 336697701341…     0     0     0     0     0     1     1     1     0         1</code></pre>
<p>As we have seen before, a diversity index of 1 can only happen if the maximal number of student in each category is 1. These schools seem to be rather small. Taking a look at the first school here</p>
<pre class="r"><code>data %&gt;% filter(CDS_CODE == &quot;17640220000001&quot;) %&gt;% pull(SCHOOL)
## [1] &quot;Nonpublic, Nonsectarian Schools&quot; &quot;Nonpublic, Nonsectarian Schools&quot;</code></pre>
<p>and we get that it is a “Nonpublic, Nonsectarian Schools” which by further investigation shows that there are quite a few of those. Lets take a look at the total enrollment in each of the schools, we have seen a couple of instances with low enrollment and we wouldn’t want those to distort our view.</p>
<pre class="r"><code>total_students &lt;- data %&gt;% 
  select(CDS_CODE:SCHOOL, ENR_TOTAL) %&gt;% 
  group_by(CDS_CODE) %&gt;%
  summarise(ENR_TOTAL = sum(ENR_TOTAL)) %&gt;% 
  ungroup() </code></pre>
<p>We also create a <code>meta</code> data.frame which stores the <code>CDS_CODE</code> along with county, district and school name.</p>
<pre class="r"><code>meta &lt;- data %&gt;%
  select(CDS_CODE:SCHOOL) %&gt;%
  distinct() </code></pre>
<p>Looking at the distribution of total enrollment</p>
<pre class="r"><code>total_students %&gt;% 
  ggplot(aes(ENR_TOTAL)) +
  geom_histogram(bins = 1000)</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-33-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>We see a big hump around the 600-700 mark, but also a big spike towards 0, lets take a closer look at the small values</p>
<pre class="r"><code>total_students %&gt;% 
  filter(ENR_TOTAL &lt; 250) %&gt;%
  ggplot(aes(ENR_TOTAL)) +
  geom_histogram(bins = 250)</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-34-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>Here we make another choice that will ultimately change the outcome of the analysis. But I will restrict the investigation to school with a total enrollment of 50 or more.</p>
<pre class="r"><code>data_big &lt;- total_students %&gt;%
  left_join(meta, by = &quot;CDS_CODE&quot;) %&gt;%
  filter(ENR_TOTAL &gt;= 50)</code></pre>
<p>Then we join that back to our enrollment data such that we have meta and diversity information in the same data.frame.</p>
<pre class="r"><code>data_enrollment &lt;- data_diversity %&gt;%
  right_join(data_big, by = &quot;CDS_CODE&quot;)</code></pre>
<p>We start by looking to see if there is some correlation between total enrollment (<code>ENR_TOTAL</code>) and the diversity index (<code>diversity</code>). We fit with a simple linear model to begin with.</p>
<pre class="r"><code>data_enrollment %&gt;%
  ggplot(aes(ENR_TOTAL, diversity)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = &quot;lm&quot;) +
  theme_minimal() +
  ylim(0, 1) +
  labs(x = &quot;Enrollment&quot;, 
       y = &quot;Diversity Index&quot;,
       title = &quot;Larger Californian schools tend to have a higher diversity index&quot;)
## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-37-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>Its quite a small slope but still about 5% increase in diversity per 2000 students. Lets verify the correlation by checking the null hypothesis.</p>
<pre class="r"><code>data_enrollment %&gt;%
  mutate(ENR_TOTAL = ENR_TOTAL / 1000) %&gt;%
  lm(diversity ~ ENR_TOTAL, data = .) %&gt;%
  summary()
## 
## Call:
## lm(formula = diversity ~ ENR_TOTAL, data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.5053 -0.1584  0.0533  0.1658  0.3926 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.447968   0.003489 128.399  &lt; 2e-16 ***
## ENR_TOTAL   0.023239   0.004132   5.624 1.92e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2111 on 9407 degrees of freedom
## Multiple R-squared:  0.003351,   Adjusted R-squared:  0.003245 
## F-statistic: 31.63 on 1 and 9407 DF,  p-value: 1.923e-08</code></pre>
<p>We can’t reject the null hypothesis of no correlation and we get a better estimate of the slope to 2.3%. Of cause we can’t extrapolate the results outside the range of the existing data since the response variable is bounded.</p>
</div>
<div id="where-are-we" class="section level2">
<h2>Where are we?</h2>
<p>Lets try to join the enrollment data to the geographical data so we can bring out some maps! The <code>longlat</code> dataset has quite a unfortunate number of missing values.</p>
<pre class="r"><code>longlat$Latitude %&gt;% is.na() %&gt;% mean()
## [1] 0.2784102</code></pre>
<p>But we will see if we can work with it anyways.</p>
<pre class="r"><code>miss_lat_div &lt;- data_enrollment %&gt;%
  left_join(longlat, by = c(&quot;CDS_CODE&quot; = &quot;CDSCode&quot;)) %&gt;% 
  filter(is.na(Latitude)) %&gt;%
  pull(diversity)

have_lat_div &lt;- data_enrollment %&gt;%
  left_join(longlat, by = c(&quot;CDS_CODE&quot; = &quot;CDSCode&quot;)) %&gt;% 
  filter(!is.na(Latitude)) %&gt;%
  pull(diversity)</code></pre>
<p>Sadly it turns out that the longitude and latitude is NOT missing at random as the distribution of the diversity index in not the same for missing and non-missing data.</p>
<pre class="r"><code>density(miss_lat_div) %&gt;% plot()</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-41-1.png" width="700px" style="display: block; margin: auto;" /></p>
<pre class="r"><code>density(have_lat_div) %&gt;% plot()</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-41-2.png" width="700px" style="display: block; margin: auto;" /></p>
<p>We will still venture on with the remaining data, but with a higher caution then before. Hopefully we will still be able to see some clustering in the remaining data.</p>
<pre class="r"><code>map &lt;- map_data(&quot;state&quot;) %&gt;%
  filter(region == &quot;california&quot;)

map_point &lt;- data_enrollment %&gt;%
  left_join(longlat, by = c(&quot;CDS_CODE&quot; = &quot;CDSCode&quot;)) %&gt;%
  filter(!is.na(Latitude)) 

map %&gt;%
  ggplot(aes(long, lat, group = group)) +
  geom_polygon(fill = &quot;grey80&quot;) +
  coord_map() +
  theme_minimal() +
  geom_point(aes(Longitude, Latitude, color = diversity),
             data = map_point,
             inherit.aes = FALSE, alpha = 0.1) +
  scale_color_viridis_c(option = &quot;A&quot;) +
  labs(title = &quot;Diversity of schools across California&quot;)</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-42-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>We don’t notice any mayor geographical trends. However there are still some gold nuggets here. Dark grey points are actually overlapping low-diversity index points since the alpha is set to <code>0.1</code> therefore we see a couple of instances in mid California where there are a couple of low-diversity index schools, with each point landing on a certain city.</p>
<p>The two mayor cities (Los Angeles and San Francisco) both have quite a few schools with high diversity, however Los Angeles have some quite dark spots. Lets zoom in to city level. Since we are getting more local, we will be using the <code>ggmap</code> package to quarry the Google Maps so we get a nice underlying map.</p>
<pre class="r"><code>LA_map &lt;- get_map(location = &#39;Los Angeles&#39;, zoom = 9)
ggmap(LA_map) +
  geom_point(data = map_point %&gt;%
                      filter(Longitude &gt; -119, Longitude &lt; -117,
                             Latitude &lt; 34.5, Latitude &gt; 33.5), 
             aes(Longitude, Latitude, color = diversity),
             alpha = 0.2) +
  scale_color_viridis_c(option = &quot;A&quot;) +
  labs(title = &quot;Low diversity areas tends towards city centers \nin Greater Los Angeles Area&quot;)</code></pre>
<p><img src="map.png" width="700px" style="display: block; margin: auto;" /></p>
<p>This maps shows much more interesting trends!! It appears that low diversity schools cluster together near city centers.</p>
</div>
<div id="where-is-the-money" class="section level2">
<h2>Where is the money?</h2>
<p>We will end this post by taking a look at if the median household income in the county in which the school is located correlates with the diversity index we have calculated for each school.</p>
<p>This is simply done by joining the two data.frames together and piping them into <code>ggplot</code>.</p>
<pre class="r"><code>data_enrollment %&gt;% 
  left_join(income_data_clean, by = c(&quot;COUNTY&quot; = &quot;county&quot;)) %&gt;%
  ggplot(aes(median_household_income, diversity)) +
  geom_jitter(alpha = 0.1, width = 500) +
  geom_smooth(method = &quot;lm&quot;) +
  ylim(0, 1) +
  theme_minimal() +
  labs(x = &quot;Median household income&quot;, y = &quot;Diversity Index&quot;,
       title = &quot;Higher diversity index in CA counties with high Median household income&quot;)</code></pre>
<p><img src="/post/2018-05-01-analysing-ethnic-diversity-in-californian-school/index_files/figure-html/unnamed-chunk-45-1.png" width="700px" style="display: block; margin: auto;" /></p>
<p>and we do indeed see a positive correlation between median household income and ethnic diversity in schools in California.</p>
<p>This is the end of this analysis, I hope you enjoyed it! See you again next time.</p>
</div>
<div id="diversity-plotting-function" class="section level2">
<h2>Diversity plotting function</h2>
<pre class="r"><code>diversity_plot &lt;- function(makeup, fix = 0.45) {
  df &lt;- tibble(id = seq_len(sum(makeup)),
               race = imap(makeup, ~ rep(.y, .x)) %&gt;% unlist())
  
  cols &lt;- structure(rainbow(length(makeup)), 
            names = as.character(seq_len(length(makeup)))) %&gt;%
    c(&quot;diag&quot; = &quot;grey30&quot;,
      &quot;other&quot; = &quot;grey70&quot;)
  
  df1 &lt;- crossing(df, df) %&gt;%
    mutate(fill = case_when(id == id1 ~ &quot;diag&quot;,
                            race == race1 ~ as.character(race),
                            TRUE ~ &quot;other&quot;)) 
  
  df1 %&gt;%
    ggplot(aes(xmin = id - fix, xmax = id + fix,
               ymin = id1 - fix, ymax = id1 + fix)) +
    geom_rect(aes(fill = fill)) +
    theme(panel.background = element_blank(), 
          panel.border = element_blank()) +
    scale_y_continuous(breaks = df[[&quot;id&quot;]], labels = df[[&quot;race&quot;]]) +
    scale_x_continuous(breaks = df[[&quot;id&quot;]], labels = df[[&quot;race&quot;]]) +
    coord_fixed() +
    scale_fill_manual(values = cols) +
    guides(fill = &quot;none&quot;) +
    labs(title = paste0(&quot;The diversity score is &quot;, 
                        signif(mean(df1$fill %in% c(&quot;diag&quot;, &quot;other&quot;)), digits = 3)))
}</code></pre>
<details closed>
<p><summary> <span title="Click to Expand"> session information </span> </summary></p>
<pre class="r"><code>
─ Session info ───────────────────────────────────────────────────────────────
 setting  value                       
 version  R version 3.6.0 (2019-04-26)
 os       macOS Mojave 10.14.6        
 system   x86_64, darwin15.6.0        
 ui       X11                         
 language (EN)                        
 collate  en_US.UTF-8                 
 ctype    en_US.UTF-8                 
 tz       America/Los_Angeles         
 date     2020-04-23                  

─ Packages ───────────────────────────────────────────────────────────────────
 ! package     * version date       lib source        
 P assertthat    0.2.1   2019-03-21 [?] CRAN (R 3.6.0)
 P backports     1.1.6   2020-04-05 [?] CRAN (R 3.6.0)
 P bitops        1.0-6   2013-08-17 [?] CRAN (R 3.6.0)
 P blogdown      0.18    2020-03-04 [?] CRAN (R 3.6.0)
 P bookdown      0.18    2020-03-05 [?] CRAN (R 3.6.0)
 P broom         0.5.5   2020-02-29 [?] CRAN (R 3.6.0)
 P cellranger    1.1.0   2016-07-27 [?] CRAN (R 3.6.0)
 P cli           2.0.2   2020-02-28 [?] CRAN (R 3.6.0)
 P clipr         0.7.0   2019-07-23 [?] CRAN (R 3.6.0)
 P colorspace    1.4-1   2019-03-18 [?] CRAN (R 3.6.0)
 P crayon        1.3.4   2017-09-16 [?] CRAN (R 3.6.0)
 P DBI           1.1.0   2019-12-15 [?] CRAN (R 3.6.0)
 P dbplyr        1.4.2   2019-06-17 [?] CRAN (R 3.6.0)
 P desc          1.2.0   2018-05-01 [?] CRAN (R 3.6.0)
 P details     * 0.2.1   2020-01-12 [?] CRAN (R 3.6.0)
 P digest        0.6.25  2020-02-23 [?] CRAN (R 3.6.0)
 P dplyr       * 0.8.5   2020-03-07 [?] CRAN (R 3.6.0)
 P ellipsis      0.3.0   2019-09-20 [?] CRAN (R 3.6.0)
 P evaluate      0.14    2019-05-28 [?] CRAN (R 3.6.0)
 P fansi         0.4.1   2020-01-08 [?] CRAN (R 3.6.0)
 P forcats     * 0.5.0   2020-03-01 [?] CRAN (R 3.6.0)
 P fs            1.4.1   2020-04-04 [?] CRAN (R 3.6.0)
 P generics      0.0.2   2018-11-29 [?] CRAN (R 3.6.0)
 P ggmap       * 3.0.0   2019-02-05 [?] CRAN (R 3.6.0)
 P ggplot2     * 3.3.0   2020-03-05 [?] CRAN (R 3.6.0)
 P glue          1.4.0   2020-04-03 [?] CRAN (R 3.6.0)
 P gtable        0.3.0   2019-03-25 [?] CRAN (R 3.6.0)
 P haven         2.2.0   2019-11-08 [?] CRAN (R 3.6.0)
 P hms           0.5.3   2020-01-08 [?] CRAN (R 3.6.0)
 P htmltools     0.4.0   2019-10-04 [?] CRAN (R 3.6.0)
 P httr          1.4.1   2019-08-05 [?] CRAN (R 3.6.0)
 P jpeg          0.1-8.1 2019-10-24 [?] CRAN (R 3.6.0)
 P jsonlite      1.6.1   2020-02-02 [?] CRAN (R 3.6.0)
 P knitr       * 1.28    2020-02-06 [?] CRAN (R 3.6.0)
 P lattice       0.20-41 2020-04-02 [?] CRAN (R 3.6.0)
 P lifecycle     0.2.0   2020-03-06 [?] CRAN (R 3.6.0)
 P lubridate     1.7.8   2020-04-06 [?] CRAN (R 3.6.0)
 P magrittr      1.5     2014-11-22 [?] CRAN (R 3.6.0)
 P modelr        0.1.6   2020-02-22 [?] CRAN (R 3.6.0)
 P munsell       0.5.0   2018-06-12 [?] CRAN (R 3.6.0)
 P nlme          3.1-145 2020-03-04 [?] CRAN (R 3.6.0)
 P patchwork   * 1.0.0   2019-12-01 [?] CRAN (R 3.6.0)
 P pillar        1.4.3   2019-12-20 [?] CRAN (R 3.6.0)
 P pkgconfig     2.0.3   2019-09-22 [?] CRAN (R 3.6.0)
 P plyr          1.8.6   2020-03-03 [?] CRAN (R 3.6.0)
 P png           0.1-7   2013-12-03 [?] CRAN (R 3.6.0)
 P purrr       * 0.3.3   2019-10-18 [?] CRAN (R 3.6.0)
 P R6            2.4.1   2019-11-12 [?] CRAN (R 3.6.0)
 P Rcpp          1.0.4.6 2020-04-09 [?] CRAN (R 3.6.0)
 P readr       * 1.3.1   2018-12-21 [?] CRAN (R 3.6.0)
 P readxl        1.3.1   2019-03-13 [?] CRAN (R 3.6.0)
   renv          0.9.3   2020-02-10 [1] CRAN (R 3.6.0)
 P reprex        0.3.0   2019-05-16 [?] CRAN (R 3.6.0)
 P RgoogleMaps   1.4.5.3 2020-02-12 [?] CRAN (R 3.6.0)
 P rjson         0.2.20  2018-06-08 [?] CRAN (R 3.6.0)
 P rlang         0.4.5   2020-03-01 [?] CRAN (R 3.6.0)
 P rmarkdown     2.1     2020-01-20 [?] CRAN (R 3.6.0)
 P rprojroot     1.3-2   2018-01-03 [?] CRAN (R 3.6.0)
 P rstudioapi    0.11    2020-02-07 [?] CRAN (R 3.6.0)
 P rvest       * 0.3.5   2019-11-08 [?] CRAN (R 3.6.0)
 P scales        1.1.0   2019-11-18 [?] CRAN (R 3.6.0)
 P sessioninfo   1.1.1   2018-11-05 [?] CRAN (R 3.6.0)
 P sp            1.4-1   2020-02-28 [?] CRAN (R 3.6.0)
 P stringi       1.4.6   2020-02-17 [?] CRAN (R 3.6.0)
 P stringr     * 1.4.0   2019-02-10 [?] CRAN (R 3.6.0)
 P tibble      * 3.0.1   2020-04-20 [?] CRAN (R 3.6.2)
 P tidyr       * 1.0.2   2020-01-24 [?] CRAN (R 3.6.0)
 P tidyselect    1.0.0   2020-01-27 [?] CRAN (R 3.6.0)
 P tidyverse   * 1.3.0   2019-11-21 [?] CRAN (R 3.6.0)
 P vctrs         0.2.4   2020-03-10 [?] CRAN (R 3.6.0)
 P withr         2.1.2   2018-03-15 [?] CRAN (R 3.6.0)
 P xfun          0.13    2020-04-13 [?] CRAN (R 3.6.2)
 P xml2        * 1.3.0   2020-04-01 [?] CRAN (R 3.6.2)
 P yaml          2.2.1   2020-02-01 [?] CRAN (R 3.6.0)

[1] /Users/emilhvitfeldthansen/Desktop/blogv4/renv/library/R-3.6/x86_64-apple-darwin15.6.0
[2] /private/var/folders/m0/zmxymdmd7ps0q_tbhx0d_26w0000gn/T/RtmpU8CJTx/renv-system-library

 P ── Loaded and on-disk path mismatch.
</code></pre>
</details>
<p><br></p>
</div>
